{% extends 'base.html' %}

{% load static %}



{% block content %}
<div class="home">
  <div class="container-xxl-fluid">
    <div class="row">
      <div class="home__overplay"></div>
      <img src="{% static 'img/background-2.png' %}" >

      <div class="home__caption">
        <span class="home__cation-text header-1">
          Người dân khỏe mạnh <br>
          là tài sản lớn nhất <br>
          của bất cứ quốc gia nào.
        </span>
      </div>
      <div class="home__service">
        <a href="#" class="home__service-button">
          <span class="home__service-button-text">
            Xem dịch vụ
          </span>
        </a>
      </div>
    </div>
  </div>
</div>
<div class="facility">
  <div class="container-xxl">
    <div class="row">
      <div class="facility-body col-xxl-">
        <div class="facility-header">
          <span class="facility-header__sub title-1">
            Tại sao bạn nên chọn
          </span>
          <span class="facility-header__main header-1">
            Dịch vụ của chúng tôi
          </span>
        </div>
        <div class="facility-body">
          <div class="facility-body__content">
            <div class="facility-body__content-header">
              Sức khoẻ của bệnh nhân được đặt lên hàng đầu 
            </div>
            <ul class="facility-body__content-list">
              <li class="facility-body__content-list__list-items">
                <span>
                  Đội ngũ Bác sĩ chuyên môn cao 
                </span>
              </li>
              <li class="facility-body__content-list__list-items">
                <span>
                  Dịch vụ chuẩn quốc tế
                </span>
              </li>
              <li class="facility-body__content-list__list-items">
                <span>
                  Trang thiết bị hiện đại
                </span>
              </li>
              <li class="facility-body__content-list__list-items">
                <span>
                  Luôn quan tâm đến người bệnh 
                </span>
              </li>
            </ul>
            <div class="facility-body__content-text">
              <span class="facility-body__content-text-1">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque placerat scelerisque tortor ornare ornare. Quisque placerat scelerisque tortor ornare ornare Convallis felis vitae tortor augue. Velit nascetur proin massa in. Consequat faucibus porttitor enim et.
              </span> <br>
              <span class="facility-body__content-text-2">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque placerat scelerisque. Convallis felis vitae tortor augue. Velit nascetur proin massa in.
              </span>
            </div>
          </div>
          <div class="facility-body__image">
            <div class="facility-body__image-1">
              <div class="facility-body__image-overplay"></div>
              <div class="facility-body__image-1__text">
                <div class="facility-body__image-1__text-header">
                  Tầm nhìn
                </div>
                <div class="facility-body__image-1__text-sub">
                  Trở thành bệnh viện đa khoa chất lượng cao dẫn đầu Việt Nam và đạt chuẩn quốc tế.
                </div>
              </div>
              <img src="{% static 'img/image-1.png' %}" alt="" class="facility-body__image-img__text">
            </div>
            <div class="d-flex" style="height: 10px; width: 430px; display: flex; position: absolute; bottom: 0">
              <div class="p-2 bg-info" style="width: 30%;"></div>
              <div class="p-2 bg-warning  flex-grow-1" style="width: 50%;"></div>
              <div class="p-2 bg-primary" style="width: 30%;"></div>
            </div>
            <div class="facility-body__image-2">
              <div class="facility-body__image-overplay"></div>
              <div class="facility-body__image-1__text">
                <div class="facility-body__image-1__text-header">
                  Sứ mệnh
                </div>
                <div class="facility-body__image-1__text-sub">
                  Xây dựng một mô hình chuẩn mực cung cấp dịch vụ khám bệnh, chữa bệnh chất lượng cao làm hài lòng người bệnh.
                </div>
              </div>
              <img src="{% static 'img/image-2.png' %}" alt="" class="facility-body__image-img__text">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="service" id="service"> 
  <div class="container-xxl">
    <div class="row g-2">
      <div class="service-body col-xxl-"> 
        <div class="service-header">
          <span class="service-header__text header-1">
            Dịch vụ
          </span>
        </div>
        <div class="service-selector ">
          <div class="service-selector__component col-sm-3 body-sub-2" data-service = "Khám sức khỏe tổng quát">
              <div class="service-selector__component-icon">
                <img src="{% static 'img/heart-rate-monitor.png' %}" alt="Tổng quát">
              </div>
              <span class="service-selector__component-sub">
                <p>Khám sức khỏe tổng quát</p>
              </span>
          </div>
          <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Tầm soát ung thư">
            <div class="service-selector__component-icon">
              <img src="{% static 'img/doctor.png' %}" alt="Ung thư">
            </div>
            <span class="service-selector__component-sub">
              <p>Tầm soát ung thư</p>
            </span>
          </a>
          <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Nội tổng quát">
              <div class="service-selector__component-icon">
                  <img src="{% static 'img/health-check.png' %}" alt="Nội tổng quát">
              </div>
              <span class="service-selector__component-sub">
                  <p>Nội tổng quát</p>
              </span>
          </a>
          <a  class="service-selector__component col-sm-3 body-sub-2" data-service = "Ngoại tổng quát">
              <div class="service-selector__component-icon">
                <img src="{% static 'img/bandage.png' %}" alt="Ngoại tổng quát">
              </div>
              <span class="service-selector__component-sub">
                <p>Ngoại tổng quát</p>
              </span>
          </a>
          <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Sản khoa">
              <div class="service-selector__component-icon">
                <img src="{% static 'img/pregnant.png' %}" alt="Sản khoa">
              </div>
              <span class="service-selector__component-sub">
                <p>Sản khoa</p>
              </span>
          </a>
          <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Nhi khoa">
              <div class="service-selector__component-icon">
                <img src="{% static 'img/mom.png' %}" alt="Y khoa">
              </div>
              <span class="service-selector__component-sub">
                <p>Nhi khoa</p>
              </span>
          </a>
          <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Cơ xương khớp">
              <div class="service-selector__component-icon">
                <img src="{% static 'img/bone.png' %}" alt="Cơ xương khớp">
              </div>
              <span class="service-selector__component-sub">
                <p>Cơ xương khớp</p>
              </span>
          </a> 
          <span class="service-selector__component col-sm-3 body-sub-2" data-service = "Tai mũi họng">
              <div class="service-selector__component-icon">
                <img src="{% static 'img/hearing-aid.png' %}" alt="Tai - mũi - họng">
              </div>
              <span class="service-selector__component-sub">
                <p>Tai - mũi - họng</p>
              </span>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="personal">
  <div class="container-xxl">
    <div class="">
      <div class="personal-body col-xxl-">
        <div class="personal-header">
          <span class="personal-header__text header-1" >
            Đội ngũ bác sĩ
          </span>
        </div>
        <div class="personal-body__cards">
          <div class="personal-body__cards-img">
            <img src="{% static 'img/doctor-1.jfif' %}" alt="" style="width: 100%; height: 100%; border-radius: 10px;">
            <div class="personal-body__cards-infor">
              <span class="personal-body__cards-infor__name">
                Bác sĩ Nguyễn 
              </span>
              <span class="personal-body__cards-infor__specialist">
                CHUYÊN KHOA: TAI - MŨI - HỌNG
              </span>
              <span class="personal-body__cards-infor__exp">
                Kinh nghiệm: 15 năm
              </span>
            </div>
          </div>
          <div class="personal-body__cards-img">
            <img src="{% static 'img/doctor-2.jfif' %}" alt="" style="width: 100%; height: 100%; border-radius: 10px;">
            <div class="personal-body__cards-infor">
              <span class="personal-body__cards-infor__name">
                Bác sĩ Lê 
              </span>
              <span class="personal-body__cards-infor__specialist">
                CHUYÊN KHOA: UNG THƯ
              </span>
              <span class="personal-body__cards-infor__exp">
                Kinh nghiệm: 15 năm
              </span>
            </div>
          </div>
          <div class="personal-body__cards-img">
            <img src="{% static 'img/doctor-3.jfif' %}" alt="" style="width: 100%; height: 100%; border-radius: 10px;">
            <div class="personal-body__cards-infor">
              <span class="personal-body__cards-infor__name">
                Bác sĩ Trần 
              </span>
              <span class="personal-body__cards-infor__specialist">
                CHUYÊN KHOA: SẢN
              </span>
              <span class="personal-body__cards-infor__exp">
                Kinh nghiệm: 13 năm
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="footer">
  <div class="container-xxl">
    <div class="row">
      <div class="footer-body">
        <div class="footer-logo col ">
          <span class="footer-logo__header header-2">
            E-CARE <br>
          </span>
          <span class="footer-logo__sub">
            Leading the Way in Medical <br>
            Excellence, Trusted Care.
          </span>
        </div>
        <div class="footer-link col">
          <span class="footer__header">
            Important Links
          </span>
          <ul class="footer__header-sub">
            <li class="footer__header-sub__list-items">Appointment</li>
            <li class="footer__header-sub__list-items">Doctors</li>
            <li class="footer__header-sub__list-items">Services</li>
            <li class="footer__header-sub__list-items">About Us</li>
          </ul>
        </div>
        <div class="footer-contact col">
          <span class="footer__header">
            Contact Us
          </span>
          <ul class="footer__header-sub">
            <li class="footer__header-sub__list-items">Call: (237) 681-812-255</li>
            <li class="footer__header-sub__list-items">Email: fildineesoe@gmail.com</li>
            <li class="footer__header-sub__list-items">Address: 0123 Someplace</li>
            <li class="footer__header-sub__list-items">Some country</li>
          </ul>
        </div>
        <div class="footer-newsletter col">
          <span class="footer__header">
            Newsletter
          </span>
          <div class="footer__newsletter-input mb-3">
            <input type="email" class="form-control footer__input" id="exampleFormControlInput1" placeholder="Enter your email address">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
 <!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" style = "transform">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">XÁC NHẬN ĐĂNG KÝ DỊCH VỤ:</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id ="cancelBtn">HỦY</button>
        <button type="button" class="btn btn-primary" id ="confirmBtn" >ĐỒNG Ý</button>
      </div>
    </div>
    </div>
  </div>
</div>
<div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" style = "transform">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Thông Tin</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body modal-body__number">
        
      </div>
    </div>
  </div>
</div>
<div id = "serviceModal" class="customModal">
  <div class="modal-content">
    <ul id="serviceList"></ul>
  </div>
</div>
{% endblock %}

{% block scripts %}
{% csrf_token %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var selectedService;
      var serviceName;
      var patientName;
      var currentQueueNumber;
      var registrationTime;
      
      // Lấy dữ liệu từ Local Storage, nếu không có thì sử dụng đối tượng trống
      var serviceCounters = JSON.parse(localStorage.getItem('serviceCounters')) || {};
  
      function showModal(modalId) {
          $('#' + modalId).modal('show');
      }
  
      function hideModal(modalId) {
          $('#' + modalId).modal('hide');
      }
  
      var serviceButtons = document.querySelectorAll('.service-selector__component');
  
      serviceButtons.forEach(function (button) {
          button.addEventListener('click', function () {
              serviceName = button.getAttribute('data-service');
  
              if (serviceCounters.hasOwnProperty(serviceName)) {
                  serviceCounters[serviceName]++;
              } else {
                  serviceCounters[serviceName] = 1;
              }
  
              // Lưu thông tin số thứ tự vào Local Storage
              localStorage.setItem('serviceCounters', JSON.stringify(serviceCounters));
  
              showModal('exampleModal');
              var modalBody = document.querySelector('#exampleModal .modal-body');
              modalBody.innerHTML = '<p class="title-1">' + serviceName + '</p>' +
                  '<p class="title-1">Số thứ tự: ' + serviceCounters[serviceName] + '</p>';
                  selectedService = serviceName;
                  if (selectedService) {
                    showModal('exampleModal');
                          getQueueNumberAndShowModal();
                        }
                      });
                    });
                    
                    var cancelBtn = document.getElementById('cancelBtn');
                    cancelBtn.addEventListener('click', function () {
                      hideModal('exampleModal');
                      hideModal('exampleModal2');
                    });
                    
                    var confirmBtn = document.getElementById('confirmBtn');
                    confirmBtn.addEventListener('click', function () {
                      confirmService();
                      saveToDatabase();
                    });
                    
                    window.confirmService = function() {
                      var serviceName = selectedService;
                      var registrationTime = new Date().toLocaleString();
                      var patientName = '{{ request.user.patient_info.ho_ten }}';
                      fetch('/get_doctor_and_queue_number/?service_name=' + serviceName)
                      .then(response => response.json())
                      .then(data => {
                        console.log('Data from /get_doctor_and_queue_number/:', data);
                        
                            // Gán giá trị cho biến global doctorName
                            doctorName = data.doctor_name;
                            currentQueueNumber = data.queue_number;
                            console.log('queue_number-modal 2', currentQueueNumber)
                            hideModal('exampleModal');
                            showModal('exampleModal2')
                            // Hiển thị thông tin trong modal 2
                            var modalBody2 = document.querySelector('#exampleModal2 .modal-body');
                            modalBody2.innerHTML = '<p class="title-1">Bác sĩ: ' + doctorName + '</p>' +
                                '<p class="title-1">Số thứ tự: ' + serviceCounters[serviceName] + '</p>' +
                                '<p class="title-1">Thời gian đăng ký: ' + registrationTime + '</p>' +
                                '<p class="title-1">Bệnh nhân: ' + patientName + '</p>';
            
                        })
              };
  
      function getQueueNumberAndShowModal() {
          fetch('/get_doctor_and_queue_number/?service_name=' + selectedService)
              .then(response => response.json())
              .then(data => {
                  currentQueueNumber = data.queue_number;
                  showModal('exampleModal');
              })
              .catch(error => console.error('Error:', error));
      }
  
      function saveToDatabase(queueNumber) {
          fetch('/get_doctor_and_queue_number/?service_name=' + serviceName)
              .then(response => response.json())
              .then(data => {
                  var registrationTime = new Date().toLocaleString();
                  var patientName = '{{ request.user.patient_info.ho_ten }}';
  
                  fetch('/save_queue/', {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/x-www-form-urlencoded',
                          'X-CSRFToken': '{{ csrf_token }}'
                      },
                      body: 'service_name=' + serviceName +
                          '&patient_name=' + patientName +
                          '&doctor_name=' + data.doctor_name +  // Sử dụng data.doctor_name thay vì biến doctorName
                          '&queue_number=' + serviceCounters[serviceName] +
                          '&registration_time=' + registrationTime
                  })
                      .then(response => response.json())
                      .then(response => {
                          if (!response.success) {
                              console.error('Error saving to database:', response.error);
                          }
                      })
              })
              .catch(error => console.error('Error from /get_doctor_and_queue_number/:', error));
      }
    }); 
  </script>
  <!-- Trong HTML -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var dropdownItems = document.querySelectorAll('.dropdown-item');
      dropdownItems.forEach(function(item) {
        item.addEventListener('click', function(event) {
          var service = item.getAttribute('data-service');
          var url = '{% url "queue_service" service="temp" %}'.replace('temp', encodeURIComponent(service));

          window.location.href = url;
        });
      });
    });
  </script>
{% endblock %}

{% block styles%}
  
{% endblock %}

