<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %} 
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
  {% comment %} <link rel="stylesheet" href="./assets/bootstrap-5.3.2-dist/">
  <link rel="stylesheet" href="./assets/css/base.css">
  <link rel="stylesheet" href="./assets/css/main-home_page.css"> {% endcomment %}
  
  <link rel="stylesheet" type="text/css" href="{% static 'bootstrap-5.3.2-dist/' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/main-home_page.css' %}">
  <link rel="stylesheet" type="text/img" href="{% static 'img' %}"> 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@800&family=Raleway:wght@600&family=Work+Sans:wght@100;200;300;400;500;600;700&family=Yeseva+One&display=swap" rel="stylesheet">
  <title>Document</title>
</head>
<body>
  <div class="header">
    <div class="container-xxl"> 
      <div class="row">
        <div class="form-page col-xxl-">
          <div class="header__logo">
            <div class="header__logo-text">
              <div><a href="" style="color: var(--primary-color); font-size: 24px; font-family: 'Raleway'; font-weight: 600; word-wrap: break-word; text-decoration: none;">e-</a>
                <a href="{%url 'home'%}" style="color: var(--primary-color); font-size: 24px; font-family: 'Raleway'; font-weight: 600; word-wrap: break-word; text-decoration: none;">Care</a></div>
            </div>
            <div class="header__logo-icon">
                <img src="{% static 'img/Rectangle 85.png' %}" alt="" style="width: 40px; height: 40px;" class="header__logo-icon-img">

            </div>
          </div>
          <div class="header__navbar caption">
            <span class="header__navbar-intro select__object">
              <a  href="{%url 'home'%}" class="header__navbar-intro">GIỚI THIỆU</a>
            </span>
            <span id="serviceDropdown" href='' class="header__navbar-infor select__object nav-item dropdown">
              <a href="#" class="header__navbar-infor nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">DANH SÁCH HÀNG CHỜ</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" data-service='Khám sức khỏe tổng quát'>Khám sức khỏe tổng quát </a></li>
                <li><a class="dropdown-item" href="#" data-service='Tầm soát ung thư'>Tầm soát ung thư </a></li>
                <li><a class="dropdown-item" href="#" data-service='Nội tổng quát'>Nội tổng quát </a></li>
                <li><a class="dropdown-item" href="#" data-service='Ngoại tổng quát'>Ngoại tổng quát </a></li>
                <li><a class="dropdown-item" href="#" data-service='Khoa sản'>Khoa sản</a></li>
                <li><a class="dropdown-item" href="#" data-service='Nhi khoa'>Nhi khoa </a></li>
                <li><a class="dropdown-item" href="#" data-service='C4ơ xương khớp'>Cơ xương khớp </a></li>
                <li><a class="dropdown-item" href="#" data-service='Tai mũi họng'>'Tai mũi họng </a></li>
              </ul>
            </span>
            <span class="header__navbar-contact select__object">
              <a href="{%url 'form'%}" class="header__navbar-contact">THÔNG TIN BỆNH NHÂN </a>
            </span>
            <span class="header__navbar-service select__object">
              <a href="{%url 'logout'%}" class="header__navbar-service">Đăng xuất</a>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="home">
    <div class="container-xxl-fluid">
      <div class="row">
        <div class="home__overplay"></div>
        <img src="{% static 'img/background-2.png' %}" >

        <div class="home__caption">
          <span class="home__cation-text header-1">
            Người dân khỏe mạnh <br>
            là tài sản lớn nhất <br>
            của bất cứ quốc gia nào.
          </span>
        </div>
        <div class="home__service">
          <a href="#" class="home__service-button">
            <span class="home__service-button-text">
              Xem dịch vụ
            </span>
          </a>
        </div>
      </div>
    </div>
  </div>
  <div class="facility">
    <div class="container-xxl">
      <div class="row">
        <div class="facility-body col-xxl-">
          <div class="facility-header">
            <span class="facility-header__sub title-1">
              Tại sao bạn nên chọn
            </span>
            <span class="facility-header__main header-1">
              Dịch vụ của chúng tôi
            </span>
          </div>
          <div class="facility-body">
            <div class="facility-body__content">
              <div class="facility-body__content-header">
                Sức khoẻ của bệnh nhân được đặt lên hàng đầu 
              </div>
              <ul class="facility-body__content-list">
                <li class="facility-body__content-list__list-items">
                  <span>
                    Đội ngũ Bác sĩ chuyên môn cao 
                  </span>
                </li>
                <li class="facility-body__content-list__list-items">
                  <span>
                    Dịch vụ chuẩn quốc tế
                  </span>
                </li>
                <li class="facility-body__content-list__list-items">
                  <span>
                    Trang thiết bị hiện đại
                  </span>
                </li>
                <li class="facility-body__content-list__list-items">
                  <span>
                    Luôn quan tâm đến người bệnh 
                  </span>
                </li>
              </ul>
              <div class="facility-body__content-text">
                <span class="facility-body__content-text-1">
                  Hệ thống y tế của chúng tôi cam kết cung cấp dịch vụ chất lượng cao và chuẩn quốc tế. Với đội ngũ y bác sĩ có kinh nghiệm và kiến thức chuyên sâu, chúng tôi không chỉ chú trọng đến việc chữa trị bệnh, mà còn tập trung vào việc duy trì sức khỏe và ngăn chặn sự xuất hiện của các vấn đề y tế. Sự đồng lòng của đội ngũ y bác sĩ, trang thiết bị y tế tiên tiến và tầm nhìn quốc tế giúp chúng tôi không ngừng nỗ lực, để mỗi bệnh nhân có thể tin tưởng vào sự chăm sóc toàn diện và hiệu quả tại hệ thống y tế của chúng tôi.
                </span>
              </div>
            </div>
            <div class="facility-body__image">
              <div class="facility-body__image-1">
                <div class="facility-body__image-overplay"></div>
                <div class="facility-body__image-1__text">
                  <div class="facility-body__image-1__text-header">
                    Tầm nhìn
                  </div>
                  <div class="facility-body__image-1__text-sub">
                    Trở thành bệnh viện đa khoa chất lượng cao dẫn đầu Việt Nam và đạt chuẩn quốc tế.
                  </div>
                </div>
                <img src="{% static 'img/image-1.png' %}" alt="" class="facility-body__image-img__text">
              </div>
              <div class="d-flex" style="height: 10px; width: 430px; display: flex; position: absolute; bottom: 0">
                <div class="p-2 bg-info" style="width: 30%;"></div>
                <div class="p-2 bg-warning  flex-grow-1" style="width: 50%;"></div>
                <div class="p-2 bg-primary" style="width: 30%;"></div>
              </div>
              <div class="facility-body__image-2">
                <div class="facility-body__image-overplay"></div>
                <div class="facility-body__image-1__text">
                  <div class="facility-body__image-1__text-header">
                    Sứ mệnh
                  </div>
                  <div class="facility-body__image-1__text-sub">
                    Xây dựng một mô hình chuẩn mực cung cấp dịch vụ khám bệnh, chữa bệnh chất lượng cao làm hài lòng người bệnh.
                  </div>
                </div>
                <img src="{% static 'img/image-2.png' %}" alt="" class="facility-body__image-img__text">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="service" id="service"> 
    <div class="container-xxl">
      <div class="row g-2">
        <div class="service-body col-xxl-"> 
          <div class="service-header">
            <span class="service-header__text header-1">
              Dịch vụ
            </span>
          </div>
          <div class="service-selector ">
            <div class="service-selector__component col-sm-3 body-sub-2" data-service = "Khám sức khỏe tổng quát">
                <div class="service-selector__component-icon">
                  <img src="{% static 'img/heart-rate-monitor.png' %}" alt="Tổng quát">
                </div>
                <span class="service-selector__component-sub">
                  <p>Khám sức khỏe tổng quát</p>
                </span>
            </div>
            <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Tầm soát ung thư">
              <div class="service-selector__component-icon">
                <img src="{% static 'img/doctor.png' %}" alt="Ung thư">
              </div>
              <span class="service-selector__component-sub">
                <p>Tầm soát ung thư</p>
              </span>
            </a>
            <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Nội tổng quát">
                <div class="service-selector__component-icon">
                    <img src="{% static 'img/health-check.png' %}" alt="Nội tổng quát">
                </div>
                <span class="service-selector__component-sub">
                    <p>Nội tổng quát</p>
                </span>
            </a>
            <a  class="service-selector__component col-sm-3 body-sub-2" data-service = "Ngoại tổng quát">
                <div class="service-selector__component-icon">
                  <img src="{% static 'img/bandage.png' %}" alt="Ngoại tổng quát">
                </div>
                <span class="service-selector__component-sub">
                  <p>Ngoại tổng quát</p>
                </span>
            </a>
            <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Khoa sản">
                <div class="service-selector__component-icon">
                  <img src="{% static 'img/pregnant.png' %}" alt="Khoa sản">
                </div>
                <span class="service-selector__component-sub">
                  <p>Khoa sản</p>
                </span>
            </a>
            <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Nhi khoa">
                <div class="service-selector__component-icon">
                  <img src="{% static 'img/mom.png' %}" alt="Y khoa">
                </div>
                <span class="service-selector__component-sub">
                  <p>Nhi khoa</p>
                </span>
            </a>
            <a class="service-selector__component col-sm-3 body-sub-2" data-service = "Cơ xương khớp">
                <div class="service-selector__component-icon">
                  <img src="{% static 'img/bone.png' %}" alt="Cơ xương khớp">
                </div>
                <span class="service-selector__component-sub">
                  <p>Cơ xương khớp</p>
                </span>
            </a> 
            <span class="service-selector__component col-sm-3 body-sub-2" data-service = "Tai mũi họng">
                <div class="service-selector__component-icon">
                  <img src="{% static 'img/hearing-aid.png' %}" alt="Tai - mũi - họng">
                </div>
                <span class="service-selector__component-sub">
                  <p>Tai - mũi - họng</p>
                </span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="personal">
    <div class="container-xxl">
      <div class="">
        <div class="personal-body col-xxl-">
          <div class="personal-header">
            <span class="personal-header__text header-1" >
              Đội ngũ bác sĩ
            </span>
          </div>
          <div class="personal-body__cards">
            <div class="personal-body__cards-img">
              <img src="{% static 'img/doctor-1.jfif' %}" alt="" style="width: 100%; height: 100%; border-radius: 10px;">
              <div class="personal-body__cards-infor">
                <span class="personal-body__cards-infor__name">
                  Bác sĩ Nguyễn 
                </span>
                <span class="personal-body__cards-infor__specialist">
                  CHUYÊN KHOA: TAI - MŨI - HỌNG
                </span>
                <span class="personal-body__cards-infor__exp">
                  Kinh nghiệm: 15 năm
                </span>
              </div>
            </div>
            <div class="personal-body__cards-img">
              <img src="{% static 'img/doctor-2.jfif' %}" alt="" style="width: 100%; height: 100%; border-radius: 10px;">
              <div class="personal-body__cards-infor">
                <span class="personal-body__cards-infor__name">
                  Bác sĩ Lê 
                </span>
                <span class="personal-body__cards-infor__specialist">
                  CHUYÊN KHOA: UNG THƯ
                </span>
                <span class="personal-body__cards-infor__exp">
                  Kinh nghiệm: 15 năm
                </span>
              </div>
            </div>
            <div class="personal-body__cards-img">
              <img src="{% static 'img/doctor-3.jfif' %}" alt="" style="width: 100%; height: 100%; border-radius: 10px;">
              <div class="personal-body__cards-infor">
                <span class="personal-body__cards-infor__name">
                  Bác sĩ Trần 
                </span>
                <span class="personal-body__cards-infor__specialist">
                  CHUYÊN KHOA: SẢN
                </span>
                <span class="personal-body__cards-infor__exp">
                  Kinh nghiệm: 13 năm
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="container-xxl">
      <div class="row">
        <div class="footer-body">
          <div class="footer-logo col ">
            <span class="footer-logo__header header-2">
              E-CARE <br>
            </span>
            <span class="footer-logo__sub">
              Leading the Way in Medical <br>
              Excellence, Trusted Care.
            </span>
          </div>
          <div class="footer-link col">
            <span class="footer__header">
              Important Links
            </span>
            <ul class="footer__header-sub">
              <li class="footer__header-sub__list-items">Appointment</li>
              <li class="footer__header-sub__list-items">Doctors</li>
              <li class="footer__header-sub__list-items">Services</li>
              <li class="footer__header-sub__list-items">About Us</li>
            </ul>
          </div>
          <div class="footer-contact col">
            <span class="footer__header">
              Contact Us
            </span>
            <ul class="footer__header-sub">
              <li class="footer__header-sub__list-items">Call: (237) 681-812-255</li>
              <li class="footer__header-sub__list-items">Email: fildineesoe@gmail.com</li>
              <li class="footer__header-sub__list-items">Address: 0123 Someplace</li>
              <li class="footer__header-sub__list-items">Some country</li>
            </ul>
          </div>
          <div class="footer-newsletter col">
            <span class="footer__header">
              Newsletter
            </span>
            <div class="footer__newsletter-input mb-3">
              <input type="email" class="form-control footer__input" id="exampleFormControlInput1" placeholder="Enter your email address">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
   <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" style = "transform">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">XÁC NHẬN ĐĂNG KÝ DỊCH VỤ:</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id ="cancelBtn">HỦY</button>
          <button type="button" class="btn btn-primary" id ="confirmBtn" >ĐỒNG Ý</button>
        </div>
      </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" style = "transform">
    <div class="modal-dialog modal-dialog-centered modal-lg" role = "document">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Thông Tin</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body modal-body__number">
          
        </div>
      </div>
    </div>
  </div>
  <div id = "serviceModal" class="customModal">
    <div class="modal-content">
      <ul id="serviceList"></ul>
    </div>
  </div>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
 
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>


  {% csrf_token %}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var selectedService;
        var serviceName;
        var patientName;
        var currentQueueNumber;
        var registrationTime;
        var timerDuration = 30000; // 30 seconds

        function showModal(modalId) {
            $('#' + modalId).modal('show');
        }
    
        function hideModal(modalId) {
            $('#' + modalId).modal('hide');
        }
    
        var serviceButtons = document.querySelectorAll('.service-selector__component');
    
        serviceButtons.forEach(function (button) {
            button.addEventListener('click', function () {
                serviceName = button.getAttribute('data-service');
    
                showModal('exampleModal');
                fetch('/get_doctor_and_queue_number/?service_name=' + serviceName)
                    .then(response => response.json())
                    .then(data => {
                        selectedService = serviceName;
                        showModal('exampleModal');
                        getQueueNumberAndShowModal();
                    })
                    .catch(error => console.error('Error:', error));
    
                // Thêm đoạn mã hiển thị thông tin số thứ tự vào modal
                var modalBody = document.querySelector('#exampleModal .modal-body');
                modalBody.innerHTML = '<p class="title-1">' + serviceName + '</p>'
            });
        });
    
        var cancelBtn = document.getElementById('cancelBtn');
        cancelBtn.addEventListener('click', function () {
            hideModal('exampleModal');
            hideModal('exampleModal2');
        });
    
        var confirmBtn = document.getElementById('confirmBtn');
        confirmBtn.addEventListener('click', function () {
            confirmService();
            saveToDatabase();
        });
    
        window.confirmService = function () {
            var serviceName = selectedService;
            var registrationTime = new Date().toLocaleString();
            var patientName = '{{ request.session.temp_storage.ho_ten }}';
            var sex = '{{ request.session.temp_storage.gioi_tinh }}';
            var birth_year = '{{ request.session.temp_storage.ngay_sinh}}';
            fetch('/get_doctor_and_queue_number/?service_name=' + serviceName)
                .then(response => response.json())
                .then(data => {
                    console.log('Data from /get_doctor_and_queue_number/:', data);
    
                    // Gán giá trị cho biến global doctorName
                    doctorName = data.doctor_name;
                    currentQueueNumber = data.queue_number;
                    console.log('queue_number-modal 2:', currentQueueNumber)
                    hideModal('exampleModal');
                    showModal('exampleModal2')
                    // Hiển thị thông tin trong modal 2
                    var modalBody2 = document.querySelector('#exampleModal2 .modal-body');
                    modalBody2.innerHTML = '<p class="title-1">Bác sĩ: ' + doctorName + '</p>' +
                        '<p class="title-1">Số thứ tự: ' + currentQueueNumber + '</p>' +
                        '<p class="title-1">Thời gian đăng ký: ' + registrationTime + '</p>' +
                        '<p class="title-1">Bệnh nhân: ' + patientName + '</p>' +
                        '<p class="title-1">Giới tính: ' + sex + '</p>' +
                        '<div id="countdownTimer" class="title-1">Chuyển đến trang thông tin bệnh nhân trong 30 giây</div>';

                        var countdownSeconds = 30;
                        var countdownElement = document.getElementById('countdownTimer');

                        var countdownInterval = setInterval(function () {
                            countdownElement.textContent = 'Chuyển đến trang thông tin bệnh nhân trong ' + countdownSeconds + ' giây';
                            countdownSeconds--;

                            if (countdownSeconds < 0) {
                                clearInterval(countdownInterval);
                                redirectToForm();
                            }
                        }, 1000);
                                  })
        };
    
        function getQueueNumberAndShowModal() {
            fetch('/get_doctor_and_queue_number/?service_name=' + selectedService)
                .then(response => response.json())
                .then(data => {
                    currentQueueNumber = data.queue_number;
                    showModal('exampleModal');
                })
                .catch(error => console.error('Error:', error));
        }
    
        {% comment %} function saveToDatabase(queueNumber) {
            var serviceCounters = {}; 
            fetch('/get_doctor_and_queue_number/?service_name=' + serviceName)
                .then(response => response.json())
                .then(data => {
                    var registrationTime = new Date().toLocaleString();
                    var patientName = '{{ request.session.temp_storage.ho_ten }}';
                    var gender = '{{ request.session.temp_storage.gioi_tinh}}';
                    var birth_year = '{{ request.session.temp_storage.ngay_sinh}}';
                    fetch('/save_queue/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: 'service_name=' + serviceName +
                            '&patient_name=' + patientName +
                            '&doctor_name=' + data.doctor_name +  
                            '&queue_number=' + data.queue_number +
                            '&registration_time=' + registrationTime +
                            '&gender=' + gender +
                            '&birth_year=' + birth_year
                    })
                        .then(response => response.json())
                        .then(response => {
                            if (!response.success) {
                                console.error('Error saving to database:', response.error);
                            }
                        })
                })
                .catch(error => console.error('Error from /get_doctor_and_queue_number/:', error));
        } {% endcomment %}
        function redirectToForm() {
          var formUrl = "{% url 'form' %}";

          fetch('{% url "emptyData" %}')
            .then(response => response.json())
            .then(data => {
            })
            .finally(() => {
              window.location.replace(formUrl); // Chuyển hướng đến trang form
            });
        }
      })
    </script>
  <!-- Trong HTML -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var dropdownItems = document.querySelectorAll('.dropdown-item');
    dropdownItems.forEach(function(item) {
      item.addEventListener('click', function(event) {
        var service = item.getAttribute('data-service');
        var url = '{% url "queue_service" service="temp" %}'.replace('temp', encodeURIComponent(service));

        window.location.href = url;
      });
    });
  });
</script>


  
  



  
</body>
</html>